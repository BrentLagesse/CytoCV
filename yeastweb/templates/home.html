<!-- Navigation bar -->
{% extends 'base.html' %}
<!-- Template specific content -->
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django Image Uploading</title>
    <style>
        body {
            font-family: var(--app-font);
            background-color: var(--page-bg);
            color: var(--text);
            margin: 0;
            padding: calc(var(--nav-height) + 10px) 10px 10px;
            min-height: 100vh;
        }
        .home-layout {
            --left-width: 70%;
            --divider-width: 8px;
            width: 100%;
            margin: 0 auto;
            display: grid;
            grid-template-columns: minmax(320px, var(--left-width)) var(--divider-width) minmax(260px, 1fr);
            align-items: stretch;
            justify-items: stretch;
            gap: 10px;
            height: calc(100vh - var(--nav-height) - 20px);
            height: calc(100dvh - var(--nav-height) - 20px);
        }
        .module-card {
            background: var(--card-bg);
            border: 1px solid var(--panel-border);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        .overview-card {
            gap: 14px;
        }
        .overview-header h1 {
            margin: 0 0 6px 0;
            font-size: 28px;
            letter-spacing: 0.2px;
        }
        .overview-header p {
            margin: 0;
            color: var(--muted);
            font-size: 14px;
        }
        .overview-scroll {
            flex: 1 1 auto;
            overflow-y: auto;
            padding-right: 6px;
            display: grid;
            gap: 16px;
        }
        .overview-section h3 {
            margin: 0 0 8px 0;
            font-size: 16px;
        }
        .overview-section p {
            margin: 0 0 10px 0;
            color: var(--text);
            line-height: 1.5;
            font-size: 14px;
        }
        .overview-list,
        .upload-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            gap: 10px;
        }
        .overview-list li,
        .upload-list li {
            background-color: var(--surface-muted);
            border: 1px solid var(--panel-border);
            border-radius: 12px;
            padding: 12px;
            display: grid;
            gap: 6px;
            font-size: 14px;
        }
        .upload-list img {
            width: 100%;
            max-width: 220px;
            height: auto;
            display: block;
            margin-top: 6px;
            border-radius: 8px;
            border: 1px solid var(--panel-border);
        }
        .cta-card {
            justify-content: center;
            text-align: center;
            gap: 16px;
        }
        .cta-card h2 {
            margin: 0;
            font-size: 22px;
        }
        .cta-card p {
            margin: 0;
            color: var(--muted);
            font-size: 14px;
        }
        .cta-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .cta-button {
            background-color: var(--accent);
            color: #fff;
            text-decoration: none;
            padding: 14px 24px;
            border-radius: 10px;
            transition: background-color 0.3s ease;
            font-weight: 600;
            letter-spacing: 0.2px;
            min-width: 176px;
            min-height: 48px;
            text-align: center;
            font-size: 15px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .cta-button:hover { background-color: var(--accent-dark); }
        .cta-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255, 255, 255, 0.45);
            border-top-color: #fff;
            border-right-color: #fff;
            border-radius: 50%;
            animation: spin 0.9s linear infinite;
            position: absolute;
            left: 14px;
            top: calc(50% - 7px);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .cta-button.loading .cta-spinner {
            opacity: 1;
            visibility: visible;
        }
        .text-link {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
        }
        .text-link:hover { text-decoration: underline; }
        .splitter {
            width: var(--divider-width);
            background: var(--surface-muted-alt);
            border: 1px solid var(--panel-border);
            border-radius: 999px;
            cursor: col-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
        }
        .splitter::after {
            content: "";
            width: 2px;
            height: 48px;
            background: var(--panel-border);
            border-radius: 999px;
        }
        .splitter.dragging,
        .splitter:hover {
            background: var(--surface-hover);
            border-color: var(--panel-border);
        }
        @media (max-width: 900px) {
            .home-layout {
                grid-template-columns: 1fr;
                height: auto;
            }
            .splitter { display: none; }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<div class="home-layout">
    <section class="module-card overview-card soft-fade-in">
        <div class="overview-header">
            <h1>Yeast Analysis Web</h1>
            <p>Research platform built by the UWB STEM team for University of Utah collaborators.</p>
        </div>
        <div class="overview-scroll">
            <div class="overview-section">
                <h3>Project overview</h3>
                <p>The project is a tool to automatically analyze WIDE-fluorescent microscopy images of yeast cells undergoing mitosis. The biologist uses yeast cells that have a controlled mutation in them. The biologists then use fluorescent labeling for points of interest (POIs), such as specific proteins, and this program automatically analyzes those POIs to collect useful data that may be used to find the cause of cellular mutation. The user will upload a special DV (Delta Vision) file that has multiple images that are taken at the same time; thus, allowing them to be overlapped. One of them is a Differential interference contrast (DIC) image, which basically is a clear image of the cells, and multiple images of the cells through different wavelengths which excite the fluorescent labels separately, leading to the POI being brightened (small dots). Currently, the fluorescent labels being used are DAPI, mCherry, and GFP.</p>
            </div>
        </div>
    </section>

    <div class="splitter" id="homeDivider" role="separator" aria-orientation="vertical" aria-label="Resize panels"></div>

    <section class="module-card cta-card soft-fade-in">
        <h2>Get started</h2>
        <p>Choose how you want to access the analysis workflow.</p>
        <div class="cta-buttons">
            {% if user.is_authenticated %}
                <a href="/profile" class="cta-button">Profile</a>
            {% else %}
                <a href="{% url 'signup' %}?fresh=1" class="cta-button">Sign up</a>
            {% endif %}
            <a href="/image/upload/" id="uploadImageButton" class="cta-button">
                <span class="cta-spinner" aria-hidden="true"></span>
                <span class="cta-label">Experiment</span>
            </a>
        </div>
        {% if not user.is_authenticated %}
            <p>Already have an account? <a href="{% url 'signin' %}" class="text-link">Sign In</a></p>
        {% endif %}
    </section>
</div>

<!-- Add JavaScript here -->
<script>
    const uploadImageButton = document.getElementById('uploadImageButton');
    if (uploadImageButton) {
        uploadImageButton.addEventListener('click', function () {
            uploadImageButton.classList.add('loading');
            uploadImageButton.style.pointerEvents = 'none'; // Disable pointer interactions
            uploadImageButton.style.cursor = 'not-allowed'; // Change the cursor to not-allowed
            uploadImageButton.setAttribute('aria-busy', 'true');
        });
    }

    const homeLayout = document.querySelector('.home-layout');
    const homeDivider = document.getElementById('homeDivider');
    if (homeLayout && homeDivider) {
        let dragging = false;
        const minLeft = 320;
        const minRight = 260;
        const getGap = () => {
            const styles = getComputedStyle(homeLayout);
            const columnGap = styles.columnGap || styles.gap || '0px';
            const gapValue = parseFloat(columnGap);
            return Number.isNaN(gapValue) ? 0 : gapValue;
        };

        const updateColumns = (clientX) => {
            const rect = homeLayout.getBoundingClientRect();
            const dividerWidth = homeDivider.offsetWidth;
            const gap = getGap();
            const available = rect.width - dividerWidth - gap * 2;
            const maxLeft = available - minRight;
            const nextLeft = Math.max(minLeft, Math.min(clientX - rect.left - gap - dividerWidth / 2, maxLeft));
            homeLayout.style.setProperty('--left-width', `${nextLeft}px`);
        };

        homeDivider.addEventListener('pointerdown', (event) => {
            if (window.matchMedia('(max-width: 900px)').matches) return;
            dragging = true;
            homeDivider.classList.add('dragging');
            if (homeDivider.setPointerCapture) {
                homeDivider.setPointerCapture(event.pointerId);
            }
            updateColumns(event.clientX);
        });

        homeDivider.addEventListener('pointermove', (event) => {
            if (!dragging) return;
            updateColumns(event.clientX);
        });

        homeDivider.addEventListener('pointerup', (event) => {
            dragging = false;
            homeDivider.classList.remove('dragging');
            if (homeDivider.releasePointerCapture) {
                homeDivider.releasePointerCapture(event.pointerId);
            }
        });
        homeDivider.addEventListener('pointercancel', (event) => {
            dragging = false;
            homeDivider.classList.remove('dragging');
            if (homeDivider.releasePointerCapture) {
                homeDivider.releasePointerCapture(event.pointerId);
            }
        });
    }
</script>

</body>
</html>
{% endblock content %}
